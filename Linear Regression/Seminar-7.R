##
## Linear Regression
## Seminar 7
## Author: galaa
## Created on 2016/11/05 11:30:00
##

## ---------------------------------------------------------------
## Exercise 1
## ---------------------------------------------------------------

## data

Y <- c(5.6, 8.9, 13.1, 19.8, 4.7, 20.5, 20.2, 13.6, 11.4, 3.3)
X <- c(2.7, 3.7, 5.7, 9.1, 2.0, 9.0, 9.4, 6.6, 6.3, 0.6)

## restricted model

summary(lm(Y ~ X - 1))

## ---------------------------------------------------------------
## Exercise 2
## ---------------------------------------------------------------

## data

y = c(-2.42, 1.43, 5.95, -3.29, 8.95, 0.21, 14.38, 15.47, 9.72, 8.31, 9.75, 10.37, 17.28, 9.52, 11.21, 29.1, 11.44, 10.62, 5.58, 9.93)
X2 = c(-1.02, -0.08, -0.23, -0.82, 0.77, -0.17, 0.97, 1.72, 0.26, 0.37, 1.18, 0.64, 1.3, 0.19, 1.59, -0.06, 0.84, 0.16, 0.63, 0.63)
X3 = c(0.5, 0.27, 1.55, 0.19, 0.11, 0.08, 1.8, 0.3, 1.89, 1.44, 0.24, 1.73, 1.55, 1.9, 0.15, 8.86, 1.01, 2.33, 0.21, 1)
X4 = c(0.79, 0.22, 0.81, 0.2, 0.51, 0.52, 0.08, 0.27, 0.81, 0.6, 0.01, 0.37, 0.72, 0.42, 0.24, 0.89, 0.58, 0.97, 0.16, 0.53)

## sample size
n = length(y)

## combine constant term
X1 = rep(x = 1, times = n)

## independent variables
X = cbind(X1, X2, X3, X4)

## restriction

R = matrix(data = c(0, 1, -2, 0, 0, 0, 0, 1), nrow = 2, byrow = TRUE)
r = c(1, 2)

## parameter estimation

b.hat = solve(t(X) %*% X) %*% t(X) %*% y
b.hat.ast = b.hat + solve(t(X) %*% X) %*% t(R) %*% solve(R %*% solve(t(X) %*% X) %*% t(R)) %*% (r - R %*% b.hat)
print(b.hat.ast)

## ---------------------------------------------------------------
## Exercise 3
## ---------------------------------------------------------------

## data

y = c(-2.42, 1.43, 5.95, -3.29, 8.95, 0.21, 14.38, 15.47, 9.72, 8.31, 9.75, 10.37, 17.28, 9.52, 11.21, 29.1, 11.44, 10.62, 5.58, 9.93)
X2 = c(-1.02, -0.08, -0.23, -0.82, 0.77, -0.17, 0.97, 1.72, 0.26, 0.37, 1.18, 0.64, 1.3, 0.19, 1.59, -0.06, 0.84, 0.16, 0.63, 0.63)
X3 = c(0.5, 0.27, 1.55, 0.19, 0.11, 0.08, 1.8, 0.3, 1.89, 1.44, 0.24, 1.73, 1.55, 1.9, 0.15, 8.86, 1.01, 2.33, 0.21, 1)
X4 = c(0.79, 0.22, 0.81, 0.2, 0.51, 0.52, 0.08, 0.27, 0.81, 0.6, 0.01, 0.37, 0.72, 0.42, 0.24, 0.89, 0.58, 0.97, 0.16, 0.53)

## ---------------------------------------------------------------
## method 1
## ---------------------------------------------------------------

## restriction

R = matrix(data = c(0, 1, -2, 0, 0, 0, 0, 1), nrow = 2, byrow = TRUE)
r = c(1, 2)

## library dependencies

# install.packages("car") ## if required
library(car) ## linearHypothesis()

## linear hypothesis; F test

linearHypothesis(model = lm(y ~ X2 + X3 + X4), hypothesis.matrix = R, rhs = r, test = "F")

## ---------------------------------------------------------------
## method 2
## ---------------------------------------------------------------

## library dependencies

# install.packages("car") ## if required
library(car) ## linearHypothesis()

## linear hypothesis; F test

linearHypothesis(model = lm(y ~ X2 + X3 + X4), c("1 * X2 - 2 * X3 = 1", "X4 = 2"), test = "F")

## ---------------------------------------------------------------
## method 3
## ---------------------------------------------------------------

y. = y
fm.1 = lm(y. ~ X2 + X3 + X4)

y. = y - X2 - 2 * X4
fm.2 = lm(y. ~ I(2 * X2 + X3) + 1)

anova(fm.1, fm.2)

## ---------------------------------------------------------------
## Exercise 4
## ---------------------------------------------------------------

## data

Y <- c(5.6, 8.9, 13.1, 19.8, 4.7, 20.5, 20.2, 13.6, 11.4, 3.3)
X <- c(2.7, 3.7, 5.7, 9.1, 2.0, 9.0, 9.4, 6.6, 6.3, 0.6)

##

new.data <- data.frame(X = seq(from = 0, to = 10, by = 1))
pred <- predict(lm(Y ~ X), new.data, interval = "prediction")
conf <- predict(lm(Y ~ X), new.data, interval = "confidence")
matplot(new.data$X, cbind(conf, pred[,-1]), lty = c(1,2,2,3,3), type = "l", ylab = "predicted y")
